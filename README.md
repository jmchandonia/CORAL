# Generix UI

This is the user facing portion of the Generix Data Clearinghouse. It is designed to simplify tasks
on our system that can be challenging for data producers and data consumers alike. 

## Installation

to get started, make sure you have npm and Angular installed. This app is built with Angular version
7.2.5.

`npm install -g @angular/cli`

Fork and clone a repo and then install all the necessary dependencies in package.json.

`npm install`

To run a development server, use the `ng serve` command and open your preferred browser to localhost:4200

## Deployment

Once you are logged into the server, you can find a clone of the repository at `/home/clearinghouse/env/generix-ui/generix-ui`.
Pull your changes and run the following build command:

`sudo ng build --prod --base-href /generix-ui/`

The build target directory is configured in angular.json as `/var/www/html/generix-ui/`. In order for the resources to be loaded correctly, the base href needs to be set to `/generix-ui/`. This can either be done with the `--base-href` flag as demonstrated above or you can manually change it in the index.html generated by the build command.

If there is not an .htaccess file in the build target directory, a new one will need to be generated for the page to load. paste 
the following code below in a new .htaccess file at `/var/www/html/generix-ui/`:

```
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteCond %{DOCUMENT_ROOT}%{REQUEST_URI} -f [OR]
  RewriteCond %{DOCUMENT_ROOT}%{REQUEST_URI} -d
  RewriteRule ^ - [L]

  RewriteRule ^ index.html
</IfModule>
```

## Overview

generix-ui is sturctured into modules that pertain to the part of the site the user is visiting. The following diagram is a high
level overview of the structure of the app.

```
app.module
|__ search.module
|   |__ search components
|__ upload.module
|   |__ upload components
|__ plot.module
|    |__ plot components
|__ shared folder
    |__ components
    |__ services
    |__ directives
    |__ models
    |__ pipes

```

 - components that do not require services (a simple display page) are declared at the app.module level and can be found in
`/src/app/shared/components`. 

 - each child module has 1 or more service(s) that act as controllers for the components within the modules. All service files 
 can be found in `/src/app/shared/services/`.

 - to encourage type safety, patterns that are commonly used throughout the app are stored as ES6 classes and can be found in
 `/src/app/shared/models`.

 ## Dependencies

 The following is a list of some of the core UI dependencies that our app depends on. It is not a comprehensive list but provides the most widely used 3rd party modules throughout the app.

 **PlotlyJS**

 [PlotlyJS](https://plot.ly/javascript/) is used to translate data bricks into data vizualizatoins that can be configured and viewed by
 the user. it is configured to work with angular using [angular-plotly](https://github.com/plotly/angular-plotly.js).

 Angular-plotly provides us with a simple to use `<plotly-plot>` component that takes a `data` and `layout` input. Server calls typically provide data and layout in sebarate objects in the response.

 *Important:* We are currently running angular-plotly at version 1.3.2 to prevent an issue that breaks
 changes for angular versions below 8. see [here](https://github.com/plotly/angular-plotly.js/issues/79) for more details.

 **jQuery**
 
[jQuery](https://jquery.com/) is installed in order to support custom UI element plugins, namely DataTables and Select2

**DataTables**

[DataTables](https://datatables.net/) is used for rendering HTML tables with javascript to add search, filtering, and pagination to large tables. DataTables is currently implemented in generix-ui wihout an 
angular wrapper, so `$` will need to be imported from jQuery in order to render a table as a DataTable.
It is best to render a table in the AfterViewInit lifecycle hook with an ElementRef provided by angular 
as shown below:

```javascript
import { ElementRef, ViewChild } from '@angular/core';
import * as $ from 'jquery';
import 'datatables.net';
import 'datatables.net-bs4'; // for bootstrap 4 styles
...
export class SomeComponent implements afterViewInit {
    @ViewChild('table') private el: ElementRef;
    dataTable: any;

    ngAfterViewInit() {
        this.someService.getSomeData().subscribe(data => {
            // assign data to table
            const table: any = $(this.el.nativeElement);
            this.dataTable = table.DataTable();
        });
    }
}
```